# План розробки PvP 128 сценарію для Arma Reforger

## 0) Мета режиму

Створити PvP-сценарій на кастомній мапі з Conflict-подібною логістикою, де кожна команда:

* стартує з **HQ (Main Base)**, яку **не можна штурмувати/захоплювати**;
* може мати **до 6 побудованих Outpost-баз**;
* **будує** бази лише в **POI (точках інтересу)**;
* прогрес/видимість наступних POI залежить від **побудованих ретрансляторів**;
* ворог спочатку **знищує ретранслятор**, після чого база стає **захоплюваною біля намету**;
* **знищення ретранслятора** викликає **відкат прогресу** (наступні POI стають невидимими/недоступними для цієї команди).

Додатково:

* **Цивільні NPC** спавняться **точково** (мало), інколи переміщуються дорогами; їх ураження = **жорсткий штраф** (пониження рангу).

---

## 1) Вихідні правила (Design Spec)

### 1.1. Стани POI/бази

Для кожного POI визначити стан:

* **Locked/Hidden**: не видно і не доступний.
* **Available**: видно (для своєї команди), дозволено підхід/розвідка.
* **Capturable**: дозволено захоплення біля намету (активується після знищення ретранслятора на цій базі у ворога).
* **Captured**: POI належить команді (після капу).
* **Buildable**: дозволено будівництво ядра/ретранслятора (після захоплення).
* **Connected/Secured**: ретранслятор побудований і живий → POI стає вузлом прогресу.
* **Disconnected**: ретранслятор знищено/розібрано → POI може лишатися захопленим, але прогрес “далі” відпадає.

### 1.2. Правила атаки/оборони

* **Оборона:** тримати ретранслятор живим.
* **Штурм:**

  1. знищити/розібрати ретранслятор на ворожій базі;
  2. база стає **Capturable** → кап біля намету;
  3. після захоплення база стає Buildable для нового власника.

### 1.3. Прогрес/відкат (фронт-мережа)

* **Побудова ретранслятора** на POI робить його Connected/Secured.
* **Connected вузли** формують мережу від HQ.
* **Відкриті наступні POI** = фронтова зона, що досяжна через мережу.
* Якщо ретранслятор знищено, мережа перераховується; POI, що втратили зв’язок, переходять у Locked/Hidden (для відповідної команди).

### 1.4. Ліміт 6 баз

* Для кожної команди: **максимум 6 активних Outpost-баз**.
* “Активна база” = POI у стані Captured (або Connected — за вашим балансом).
* При спробі побудови 7-ї бази: відмова (або вимога спочатку втратити/розібрати одну з існуючих).

### 1.5. POI-групи (щоб ворог не знав наперед)

* Кожний “слот прогресу” має **набір кандидатів POI (2–5)**.
* Коли слот відкривається: **своя команда бачить усі кандидати**.
* Коли обраний кандидат **захоплено + побудовано ретранслятор**:

  * інші кандидати цього слоту стають Locked/Hidden для цієї команди;
  * ворогу кандидати не показуються (до моменту виявлення/контакту — опційно).

### 1.6. Заборона штурму HQ

* HQ не входить у список цілей перемоги.
* Навколо HQ створюється **No-Assault Zone**:

  * попередження → примусове повернення/телепорт або штраф (за вибором);
  * заборона мінування/підривів у периметрі (за можливості).

### 1.7. Умови перемоги

* HQ не враховується.
* Перемога настає, якщо:

  * ворог має **0 активних Outpost-баз**, або
  * по таймеру команда має **більше активних Outpost-баз**, ніж ворог.

### 1.8. Цивільні NPC

* Спавн **лише в обраних POI** та/або на визначених маршрутах.
* Невелика кількість (для продуктивності).
* Ураження цивільних гравцем → **повне пониження рангу** (наприклад до найнижчого або “renegade” за вашою політикою).
* Цивільні можуть:

  * сидіти/перебувати в POI;
  * інколи рухатись дорогами у цивільному транспорті.

---

## 2) Архітектура модів і залежностей

### 2.1. Поділ на 3 моди (рекомендовано)

1. **Map Mod**

   * World/Terrain/дороги/navmesh, POI-лейери.
2. **Content Mod**

   * ваші префаби: ретранслятор, будівлі бази, цивільні пропси/транспорт, зброя/спорядження.
3. **Scenario Mod**

   * Missions/*.conf, стартові бази, POI-групи, логіка прогресу/відкату, win conditions, цивільні.

### 2.2. Workshop-залежності

* Додавати готові моди як **dependency** (не копіювати контент).
* Для зброї: підключення в арсенали через каталоги/фракції або “soft adding” підхід.

---

## 3) Дані та інструменти (що треба підготувати)

### 3.1. Список POI

Для кожного POI:

* ID, назва, координати центру.
* Розмір/радіус зони.
* Сторони, які можуть з ним взаємодіяти.
* Прив’язка до “слоту прогресу” (групи кандидатів).

### 3.2. Граф прогресу

Описати граф:

* вузли = слоти прогресу (не конкретні POI),
* кожен слот має 2–5 POI-кандидатів,
* ребра = порядок відкриття слотів.

### 3.3. Префаби

* **Relay Prefab** (будівельний об’єкт з HP/Damage).
* **POI Tent/Flag Prefab** (точка капу біля намету).
* **Base Core Prefab** (об’єкт, що визначає “існування” бази для логістики, якщо треба).
* **Civilian NPC Prefabs** (кілька варіантів).
* **Civilian Vehicle Prefabs** (1–2 типи, прості).

---

## 4) Системи сценарію (сервер-авторитет)

### 4.1. Frontline/Connectivity Manager

Єдиний серверний менеджер, що:

* тримає стан слотів прогресу та POI;
* веде лічильник активних баз (≤6);
* реагує на події:

  * POI захоплено,
  * ретранслятор побудовано,
  * ретранслятор знищено/розібрано,
  * база втрачена.
* перераховує мережу “Connected” від HQ і визначає, що відкрито/закрито.

### 4.2. Marker/Visibility System

* Маркери POI створюються/видаляються динамічно.
* Видимість маркерів — строго по фракції.
* Ворог не бачить “кандидатів POI”, бачить лише:

  * розвідані/виявлені бази (опційно),
  * або тільки те, що отримано через контакт/радіус.

### 4.3. Build Slot System

* На POI після захоплення активується будівельний слот.
* Перед розгортанням ретранслятора перевіряється:

  * POI у стані Buildable,
  * команда не перевищила ліміт 6.

### 4.4. Capture Rules

* Якщо ретранслятор на базі живий: кап вимкнений.
* Якщо ретранслятор знищено/розібрано: кап увімкнений.

### 4.5. Win Condition System

* Таймер матчу.
* Дострокова перемога: ворог має 0 активних Outpost-баз.
* Перемога по таймеру: порівняння активних баз.

### 4.6. No-Assault Zone (HQ)

* Серверна перевірка входу/присутності ворога в зоні.
* Реакція: попередження → примусове виштовхування/телепорт/штраф.

### 4.7. Civilian System

* Таблиця “civilian POI spawns” (де можуть з’являтися цивільні).
* Таблиця “civilian routes” (короткі маршрути дорогами).
* Логіка спавну:

  * небагато NPC;
  * ротація за таймером;
  * контроль кількості (cap).
* Логіка штрафу:

  * визначити цивільну фракцію;
  * при ураженні цивільного гравцем → пониження рангу.

---

## 5) План робіт (етапи)

### Етап 1 — Препродакшн (специфікація)

**Вихід:** документ правил + таблиця POI + граф слотів.

* Затвердити:

  * кількість слотів прогресу (рекомендовано 8–12),
  * по 2–5 кандидатів POI на слот,
  * ліміти (6 баз),
  * win conditions,
  * політику цивільних (кількість, де, як часто).

### Етап 2 — Технічний прототип (на тестовій сцені)

**Мета:** довести, що state machine працює.

* Реалізувати менеджер прогресу (без контенту).
* Зробити 2–3 слоти прогресу з фейковими POI.
* Перевірити:

  * відкриття кандидатів,
  * вибір одного POI,
  * побудова ретранслятора → відкриття наступного слоту,
  * знищення ретранслятора → відкат.

### Етап 3 — Інтеграція з кастомною мапою

* Розставити POI-лейери.
* Перевірити дороги/navmesh для цивільних маршрутів.
* Валідувати продуктивність (сервер/клієнти).

### Етап 4 — Конфлікт-логістика і базові сервіси

* Додати логістичні елементи (постачання, будівництво, транспорт) у стилі Conflict.
* Визначити, що саме робить база “корисною” (спавн, склад, сервіс тощо).

### Етап 5 — Цивільні (мінімальний MVP)

* Статичні цивільні у 3–5 POI.
* Штраф за ураження.
* Потім додати 1–2 маршрути з цивільним авто.

### Етап 6 — Баланс і анти-аб’юз

* Налаштувати:

  * час капу,
  * HP/repair релейки,
  * вартість будівництва,
  * швидкість прогресу,
  * межі No-Assault для HQ.
* Протидія air-spam:

  * цивільні POI як “ризикова зона” для бомбардувань,
  * обмеження на повторні удари по HQ/спавну (якщо потрібно).

### Етап 7 — Серверний реліз і підтримка

* Пакування модів.
* Валідація залежностей.
* Тест оновлень (регресія після патчів гри).
* Набір логів/метрик для дебагу (падіння мережі прогресу, зникнення маркерів, неправильний ліміт баз).

---

## 6) Тест-план (критичні сценарії)

1. Команда будує базу №1 (після HQ) → відкривається слот №2.
2. З кількох кандидатів слот №2 обирається один → інші ховаються.
3. Ворог знищує ретранслятор на базі → база стає capturable.
4. Базу захоплюють → тепер будівництво доступне новому власнику.
5. Відкат прогресу:

   * знищили ретранслятор на “вузловій” базі → наступні слоти стають невидимими.
6. Ліміт 6:

   * спроба побудувати 7-му базу → відмова.
7. HQ:

   * ворог заходить у No-Assault Zone → коректна реакція.
8. Цивільні:

   * гравець вбиває цивільного → пониження рангу.
   * цивільний їде по маршруту → не застряє, коректно деспавниться/заміщується.

---

## 7) Ризики і способи зменшення

* **Флуктуації фронту (занадто сильний відкат):** підняти HP релейки, додати repair-опції, збільшити час капу.
* **Аб’юз цивільних (випадкові штрафи):** ставити цивільних поза гарячими зонами, мінімізувати їх кількість, додати "combat exception" правила.
* **Продуктивність 128 PvP:** мінімізувати AI, контролювати кількість маркерів, уникати частого перерахунку мережі (робити debounce/таймер).

---

## 8) Визначення готовності (Definition of Done)

Сценарій вважається готовим до публічного тесту, якщо:

* прогрес/відкат працює у 100% тестів;
* ліміт 6 баз не обходиться;
* маркери не “світять” ворогу кандидатні POI;
* ретранслятор → ключовий об’єкт оборони; його знищення коректно відкриває кап;
* HQ реально не штурмується (геймплейно і технічно);
* цивільні не вбивають продуктивність і дають керований анти-авіа-спам ефект.
